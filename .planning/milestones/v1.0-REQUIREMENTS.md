# Requirements Archive: v1.0 Host-Native Runner

**Archived:** 2026-02-12
**Status:** SHIPPED

This is the archived requirements specification for v1.0.
For current requirements, see `.planning/REQUIREMENTS.md` (created for next milestone).

---

# Requirements: NanoClaw Host-Native Runner

**Defined:** 2026-02-07
**Core Value:** Users can toggle between container isolation and host-native execution via a single config file

## v1 Requirements

Requirements for initial release. Each maps to roadmap phases.

### Configuration System

- [x] **CFG-01**: App reads `nanoclaw.config.jsonc` from project root, parsing JSONC (JSON with Comments)
- [x] **CFG-02**: Config validation runs at startup with actionable error messages pointing to exact problems (field name, expected value, what was found)
- [x] **CFG-03**: App runs in container mode with current behavior when config file is absent (zero behavioral change for existing users)
- [x] **CFG-04**: Config file ships as a self-documenting template with extensive inline comments explaining every field, every mode, and every trade-off
- [x] **CFG-05**: Config values support `${VAR}` and `${VAR:-default}` environment variable expansion, especially for MCP server args and paths

### Execution Mode

- [x] **EXEC-01**: Config has an `executionMode` field accepting `"container"` or `"host"`, defaulting to `"container"`
- [x] **EXEC-02**: Startup prints a clear, unmistakable banner/warning when running in host mode, stating the agent has full macOS access
- [x] **EXEC-03**: Host runner spawns `claude` (agent-runner) directly on macOS as a subprocess instead of inside a container
- [x] **EXEC-04**: Host runner reuses the existing agent-runner code with path-configurable env vars (not a separate implementation)
- [x] **EXEC-05**: Container runner continues working unchanged when `executionMode` is `"container"`
- [x] **EXEC-06**: Config exposes macOS Seatbelt sandbox settings for host mode via the Agent SDK's `sandbox` option, with clear documentation on how to enable/disable/customize
- [x] **EXEC-07**: Sandbox settings are prominently documented in the config template so users can easily unlock or tighten restrictions

### MCP Servers

- [x] **MCP-01**: MCP servers configured in `nanoclaw.config.jsonc` with a `modes` array per server (`["host"]`, `["container"]`, or `["host", "container"]`)
- [x] **MCP-02**: Servers without a `modes` field default to `["host", "container"]` (available in both modes)
- [x] **MCP-03**: Runner filters MCP servers at agent startup, only loading servers whose `modes` include the current execution mode
- [x] **MCP-04**: Host mode uses `settingSources: ['user', 'project']` to inherit global MCP servers from `~/.claude/settings.json`
- [x] **MCP-05**: Startup logs which MCP servers are active and which were filtered out due to mode incompatibility
- [x] **MCP-06**: On startup, attempt to connect to each configured MCP server and report status (connected/failed/timeout) without blocking startup

### Per-Group Overrides

- [x] **GRP-01**: Individual groups in `registered_groups.json` can specify an `executionMode` field that overrides the global config
- [x] **GRP-02**: Groups without an `executionMode` field inherit the global setting
- [x] **GRP-03**: Per-group mode is resolved at message-processing time, not at startup

### Host Mode Security

- [x] **SEC-01**: Host mode tool allow-list configurable in config, controlling which tools the agent can use (defaults to full Claude Code tool set)
- [x] **SEC-02**: IPC authorization works correctly in host mode (agents can only write to their own group's IPC directory)
- [x] **SEC-03**: Non-main groups in host mode do not receive `bypassPermissions` -- they use default permission mode or sandbox mode

## Traceability

| Requirement | Phase | Status |
|-------------|-------|--------|
| CFG-01 | Phase 1 | Complete |
| CFG-02 | Phase 1 | Complete |
| CFG-03 | Phase 1 | Complete |
| CFG-04 | Phase 2 | Complete |
| CFG-05 | Phase 2 | Complete |
| EXEC-01 | Phase 1 | Complete |
| EXEC-02 | Phase 8 | Complete |
| EXEC-03 | Phase 4 | Complete |
| EXEC-04 | Phase 3 | Complete |
| EXEC-05 | Phase 3 | Complete |
| EXEC-06 | Phase 5 | Complete |
| EXEC-07 | Phase 5 | Complete |
| MCP-01 | Phase 6 | Complete |
| MCP-02 | Phase 6 | Complete |
| MCP-03 | Phase 6 | Complete |
| MCP-04 | Phase 7 | Complete |
| MCP-05 | Phase 6 | Complete |
| MCP-06 | Phase 7 | Complete |
| GRP-01 | Phase 8 | Complete |
| GRP-02 | Phase 8 | Complete |
| GRP-03 | Phase 8 | Complete |
| SEC-01 | Phase 5 | Complete |
| SEC-02 | Phase 5 | Complete |
| SEC-03 | Phase 5 | Complete |

**Coverage:**
- v1 requirements: 24 total
- Shipped: 24
- Unmapped: 0

---

## Milestone Summary

**Shipped:** 24 of 24 v1 requirements
**Adjusted:** None -- all requirements shipped as originally defined
**Dropped:** None

---
*Archived: 2026-02-12 as part of v1.0 milestone completion*
